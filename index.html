
<!-- Modal histórico atualizado -->
<div id="historyModal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeHistory()">&times;</span>
    <h3>Histórico de mensagens enviadas</h3>
    
    <label for="hospitalFilter">Filtrar por hospital:</label>
    <select id="hospitalFilter" style="width:100%; padding:8px; margin-bottom:15px; border-radius:6px; border:1px solid #ccc;">
      <option value="all">Todos</option>
    </select>

    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr style="background:#f0f4f8;">
          <th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Hospital</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Mensagem</th>
          <th style="text-align:left; padding:8px; border-bottom:1px solid #ddd;">Data/Hora</th>
        </tr>
      </thead>
      <tbody id="messageHistoryTable"></tbody>
    </table>
  </div>
</div>

<script>
const hospitalFilter = document.getElementById('hospitalFilter');
const messageHistoryTable = document.getElementById('messageHistoryTable');

function openHistory() {
  // Atualiza opções do filtro
  const uniqueHospitals = [...new Set(messageHistoryData.map(m => m.hospital))];
  hospitalFilter.innerHTML = `<option value="all">Todos</option>` + uniqueHospitals.map(h => `<option value="${h}">${h}</option>`).join('');

  renderHistoryTable('all');
  historyModal.classList.add('show');
}

hospitalFilter.addEventListener('change', () => {
  renderHistoryTable(hospitalFilter.value);
});

function renderHistoryTable(filterHospital) {
  let dataToShow = [...messageHistoryData].reverse(); // mais recente no topo
  if (filterHospital !== 'all') dataToShow = dataToShow.filter(m => m.hospital === filterHospital);

  messageHistoryTable.innerHTML = dataToShow.map(msg => `
    <tr>
      <td style="padding:8px; border-bottom:1px solid #ddd;">${msg.hospital}</td>
      <td style="padding:8px; border-bottom:1px solid #ddd;">${msg.mensagem}</td>
      <td style="padding:8px; border-bottom:1px solid #ddd;">${msg.date}</td>
    </tr>
  `).join('');
}

// Ao enviar uma mensagem, adicionamos a data/hora
document.getElementById('contactForm').addEventListener('submit', e => {
  e.preventDefault();
  const form = e.target;
  const data = new FormData(form);
  const hospital = form.Hospital.value;
  const mensagem = form.Mensagem.value;
  const now = new Date();
  const formattedDate = now.toLocaleString();

  fetch(form.action, { method: 'POST', body: data, headers: { 'Accept': 'application/json' } })
    .then(response => {
      if(response.ok) {
        form.reset(); closeModal();
        showToast(`Hospital ${hospital} recebeu sua mensagem!`);
        messageHistoryData.push({ hospital, mensagem, date: formattedDate });
      } else { alert('Erro ao enviar mensagem.'); }
    })
    .catch(() => alert('Erro ao enviar mensagem.'));
});
</script>






